---
interface Props {
  speed?: number;
  delay?: number;
}

const { speed = 0.3, delay = 0 } = Astro.props;
---

<div class="fade-in-section" data-delay={delay}>
  <slot />
</div>

<style>
  .fade-in-section {
    opacity: 0;
    transform: translateY(30px);
    transition: opacity 0.8s ease-out, transform 0.8s ease-out;
  }

  .fade-in-section.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  @media (prefers-reduced-motion: reduce) {
    .fade-in-section {
      opacity: 1;
      transform: none;
      transition: none;
    }
  }
</style>

<script>
  function initFadeIn() {
    const sections = document.querySelectorAll('.fade-in-section');
    
    const observerOptions = {
      threshold: 0.1,
      rootMargin: '0px 0px -100px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const delay = parseInt(entry.target.getAttribute('data-delay') || '0');
          setTimeout(() => {
            entry.target.classList.add('is-visible');
          }, delay);
          observer.unobserve(entry.target);
        }
      });
    }, observerOptions);

    // Check for reduced motion preference
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    
    if (prefersReducedMotion) {
      sections.forEach(section => section.classList.add('is-visible'));
    } else {
      sections.forEach(section => observer.observe(section));
    }
  }

  // Initialize on load
  initFadeIn();
  
  // Re-initialize after view transitions
  document.addEventListener('astro:after-swap', initFadeIn);
</script>
