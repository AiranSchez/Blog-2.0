<!DOCTYPE html><html lang="es" class="scroll-smooth"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="canonical" href="https://your-domain.com/es/blog/como-pasamos-un-proceso-de-11-horas-a-37-minutos/"><!-- Preconnect to external domains for better performance --><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="https://api.web3forms.com" crossorigin><title>Como pasamos un proceso de 11 horas a 37 minutos - Air√°n</title><meta name="description" content="optimizaci√≥n de un proceso en data engineering"><!-- Theme color - will be updated by script based on dark mode --><meta name="theme-color" content="#dce1de" id="theme-color-meta"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://your-domain.com/es/blog/como-pasamos-un-proceso-de-11-horas-a-37-minutos/"><meta property="og:title" content="Como pasamos un proceso de 11 horas a 37 minutos - Air√°n"><meta property="og:description" content="optimizaci√≥n de un proceso en data engineering"><meta property="og:image" content="https://your-domain.com/og-image.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://your-domain.com/es/blog/como-pasamos-un-proceso-de-11-horas-a-37-minutos/"><meta property="twitter:title" content="Como pasamos un proceso de 11 horas a 37 minutos - Air√°n"><meta property="twitter:description" content="optimizaci√≥n de un proceso en data engineering"><meta property="twitter:image" content="https://your-domain.com/og-image.jpg"><!-- Alternate languages --><link rel="alternate" hreflang="en" href="https://your-domain.com/en/blog/como-pasamos-un-proceso-de-11-horas-a-37-minutos/"><link rel="alternate" hreflang="es" href="https://your-domain.com/es/blog/como-pasamos-un-proceso-de-11-horas-a-37-minutos/"><link rel="alternate" hreflang="ja" href="https://your-domain.com/ja/blog/como-pasamos-un-proceso-de-11-horas-a-37-minutos/"><!-- ViewTransitions disabled for performance --><script>
      // Initialize theme with FOUC prevention and system preference detection
      (function() {
        const stored = localStorage.getItem('theme');
        let theme;
        
        if (stored) {
          // Use stored preference
          theme = stored;
        } else {
          // Detect system preference on first visit
          theme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
          localStorage.setItem('theme', theme);
        }
        
        // Apply theme immediately (before page renders)
        const html = document.documentElement;
        const themeMeta = document.getElementById('theme-color-meta');
        
        if (theme === 'dark') {
          html.classList.add('dark');
          html.style.colorScheme = 'dark';
          if (themeMeta) themeMeta.setAttribute('content', '#1f2421');
        } else {
          html.classList.remove('dark');
          html.style.colorScheme = 'light';
          if (themeMeta) themeMeta.setAttribute('content', '#dce1de');
        }
      })();
    </script><link rel="stylesheet" href="/_astro/_slug_.DZNQtyJ1.css"></head> <body class="bg-alabaster dark:bg-carbon text-carbon dark:text-alabaster transition-colors duration-300">  <!-- Skip to main content link for keyboard navigation --><a href="#main-content" class="skip-to-main"> Saltar al contenido principal </a> <header class="sticky top-0 z-[var(--z-sticky)] bg-alabaster/90 dark:bg-carbon/90 backdrop-blur-sm border-b border-muted/20 dark:border-stormy/20 transition-colors duration-300"> <nav class="container-custom py-4" aria-label="Main navigation"> <div class="flex items-center justify-between"> <!-- Logo / Brand --> <a href="/es/" class="text-2xl font-bold text-stormy dark:text-seaweed hover:text-seaweed dark:hover:text-muted transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-stormy rounded px-2 py-1">
Air√°n Sanchez
</a> <!-- Desktop Navigation --> <div class="hidden md:flex items-center gap-6"> <a href="/es/" class="text-carbon dark:text-alabaster hover:text-stormy dark:hover:text-seaweed transition-colors font-medium focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-stormy rounded px-2 py-1"> Inicio </a> <a href="/es/blog/" class="text-carbon dark:text-alabaster hover:text-stormy dark:hover:text-seaweed transition-colors font-medium focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-stormy rounded px-2 py-1"> Blog </a> <div class="flex items-center gap-2 ml-4 border-l border-muted/20 dark:border-stormy/20 pl-4"> <!-- Theme Toggle --> <button id="theme-toggle" type="button" aria-label="Toggle theme" class="p-2 sm:p-2.5 min-w-[44px] min-h-[44px] rounded-lg hover:bg-muted/20 dark:hover:bg-stormy/20 transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-stormy touch-manipulation"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" id="theme-icon-light" aria-hidden="true" class="lucide lucide-sun w-6 h-6 hidden dark:block"> <circle cx="12" cy="12" r="4"></circle><path d="M12 2v2"></path><path d="M12 20v2"></path><path d="m4.93 4.93 1.41 1.41"></path><path d="m17.66 17.66 1.41 1.41"></path><path d="M2 12h2"></path><path d="M20 12h2"></path><path d="m6.34 17.66-1.41 1.41"></path><path d="m19.07 4.93-1.41 1.41"></path>  </svg> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" id="theme-icon-dark" aria-hidden="true" class="lucide lucide-moon w-6 h-6 block dark:hidden"> <path d="M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401"></path>  </svg> </button> <!-- Language Switcher --> <div class="relative"> <button id="language-toggle" type="button" aria-label="Change language" class="min-w-[44px] min-h-[44px]" aria-haspopup="true" aria-expanded="false" aria-controls="language-dropdown" class="p-2 rounded-lg hover:bg-muted/20 dark:hover:bg-stormy/20 transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-stormy touch-manipulation"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" class="lucide lucide-languages w-5 h-5"> <path d="m5 8 6 6"></path><path d="m4 14 6-6 2-3"></path><path d="M2 5h12"></path><path d="M7 2h1"></path><path d="m22 22-5-10-5 10"></path><path d="M14 18h6"></path>  </svg> </button> <div id="language-dropdown" role="menu" aria-labelledby="language-toggle" class="absolute right-0 mt-2 w-40 bg-white dark:bg-carbon-700 border border-alabaster-300 dark:border-carbon-600 rounded-lg shadow-strong opacity-0 invisible scale-95 transition-all duration-200 origin-top-right"> <a href="/en/blog/como-pasamos-un-proceso-de-11-horas-a-37-minutos/" role="menuitem" lang="en" hreflang="en" class="block px-4 py-2.5 hover:bg-muted/10 dark:hover:bg-stormy/10 transition-colors first:rounded-t-lg last:rounded-b-lg focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-stormy" data-lang="en">
üá¨üáß English
</a> <a href="/es/blog/como-pasamos-un-proceso-de-11-horas-a-37-minutos/" role="menuitem" lang="es" hreflang="es" class="block px-4 py-2.5 hover:bg-muted/10 dark:hover:bg-stormy/10 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-stormy" data-lang="es">
üá™üá∏ Espa√±ol
</a> <a href="/ja/blog/como-pasamos-un-proceso-de-11-horas-a-37-minutos/" role="menuitem" lang="ja" hreflang="ja" class="block px-4 py-2.5 hover:bg-muted/10 dark:hover:bg-stormy/10 transition-colors last:rounded-b-lg focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-stormy" data-lang="ja">
üáØüáµ Êó•Êú¨Ë™û
</a> </div> </div> </div> </div> <!-- Mobile Menu Button --> <button id="mobile-menu-toggle" type="button" aria-label="Toggle mobile menu" aria-expanded="false" aria-controls="mobile-menu" class="md:hidden p-2.5 min-w-[48px] min-h-[48px] rounded-lg hover:bg-muted/20 dark:hover:bg-stormy/20 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-stormy touch-manipulation"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" id="mobile-menu-icon-open" aria-hidden="true" class="lucide lucide-menu w-7 h-7"> <path d="M4 5h16"></path><path d="M4 12h16"></path><path d="M4 19h16"></path>  </svg> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" id="mobile-menu-icon-close" aria-hidden="true" class="lucide lucide-x w-7 h-7 hidden"> <path d="M18 6 6 18"></path><path d="m6 6 12 12"></path>  </svg> </button> </div> <!-- Mobile Menu --> <div id="mobile-menu" class="md:hidden hidden mt-4 pt-4 border-t border-muted/20 dark:border-stormy/20 animate-[slideDown_200ms_ease-out]"> <nav class="flex flex-col gap-3" aria-label="Mobile navigation"> <a href="/es/" class="text-carbon dark:text-alabaster hover:text-stormy dark:hover:text-seaweed transition-colors font-medium px-2 py-2 rounded focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-stormy"> Inicio </a> <a href="/es/blog/" class="text-carbon dark:text-alabaster hover:text-stormy dark:hover:text-seaweed transition-colors font-medium px-2 py-2 rounded focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-stormy"> Blog </a> <div class="pt-3 mt-3 border-t border-muted/20 dark:border-stormy/20 flex flex-col gap-2"> <span class="text-xs uppercase text-alabaster-600 dark:text-carbon-400 font-semibold px-2"> Configuraci√≥n </span> <button id="mobile-theme-toggle" type="button" class="flex items-center gap-3 text-carbon dark:text-alabaster hover:text-stormy dark:hover:text-seaweed transition-colors font-medium px-3 py-3 min-h-[48px] rounded focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-stormy text-left touch-manipulation"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" class="lucide lucide-sun w-6 h-6 hidden dark:block"> <circle cx="12" cy="12" r="4"></circle><path d="M12 2v2"></path><path d="M12 20v2"></path><path d="m4.93 4.93 1.41 1.41"></path><path d="m17.66 17.66 1.41 1.41"></path><path d="M2 12h2"></path><path d="M20 12h2"></path><path d="m6.34 17.66-1.41 1.41"></path><path d="m19.07 4.93-1.41 1.41"></path>  </svg> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" class="lucide lucide-moon w-6 h-6 block dark:hidden"> <path d="M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401"></path>  </svg> <span id="mobile-theme-text"> Modo Claro </span> </button> <div class="flex flex-col gap-1"> <span class="text-xs uppercase text-alabaster-600 dark:text-carbon-400 font-semibold px-2 mb-1"> Idioma </span> <a href="/en/blog/como-pasamos-un-proceso-de-11-horas-a-37-minutos/" class="flex items-center gap-3 text-carbon dark:text-alabaster hover:text-stormy dark:hover:text-seaweed transition-colors px-3 py-3 min-h-[48px] rounded focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-stormy">
üá¨üáß English
</a> <a href="/es/blog/como-pasamos-un-proceso-de-11-horas-a-37-minutos/" class="flex items-center gap-3 text-carbon dark:text-alabaster hover:text-stormy dark:hover:text-seaweed transition-colors px-3 py-3 min-h-[48px] rounded focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-stormy">
üá™üá∏ Espa√±ol
</a> <a href="/ja/blog/como-pasamos-un-proceso-de-11-horas-a-37-minutos/" class="flex items-center gap-3 text-carbon dark:text-alabaster hover:text-stormy dark:hover:text-seaweed transition-colors px-3 py-3 min-h-[48px] rounded focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-stormy">
üáØüáµ Êó•Êú¨Ë™û
</a> </div> </div> </nav> </div> </nav> </header> <script type="module">const a=document.getElementById("theme-toggle"),m=document.getElementById("mobile-theme-toggle"),l=document.getElementById("mobile-theme-text");function s(){if(l){const e=document.documentElement.classList.contains("dark");l.textContent=e?"Light Mode":"Dark Mode"}}function d(){const e=document.documentElement;e.classList.contains("dark")?(e.classList.remove("dark"),e.style.colorScheme="light",localStorage.setItem("theme","light"),document.querySelector('meta[name="theme-color"]')?.setAttribute("content","#dce1de")):(e.classList.add("dark"),e.style.colorScheme="dark",localStorage.setItem("theme","dark"),document.querySelector('meta[name="theme-color"]')?.setAttribute("content","#1f2421")),s()}s();a?.addEventListener("click",d);m?.addEventListener("click",d);const t=document.getElementById("language-toggle"),n=document.getElementById("language-dropdown");t&&n&&(t.addEventListener("click",e=>{e.stopPropagation();const i=t.getAttribute("aria-expanded")==="true";t.setAttribute("aria-expanded",String(!i)),n.classList.toggle("opacity-0"),n.classList.toggle("invisible")}),document.addEventListener("click",()=>{t.setAttribute("aria-expanded","false"),n.classList.add("opacity-0","invisible")}));const o=document.getElementById("mobile-menu-toggle"),c=document.getElementById("mobile-menu"),g=document.getElementById("mobile-menu-icon-open"),r=document.getElementById("mobile-menu-icon-close");o&&c&&o.addEventListener("click",()=>{const e=o.getAttribute("aria-expanded")==="true";o.setAttribute("aria-expanded",String(!e)),c.classList.toggle("hidden"),g?.classList.toggle("hidden"),r?.classList.toggle("hidden")});</script> <main class="min-h-screen bg-alabaster dark:bg-carbon py-12"> <article class="container mx-auto px-4 max-w-4xl"> <header class="mb-8"> <h1 class="text-5xl font-bold mb-4 text-stormy dark:text-seaweed"> Como pasamos un proceso de 11 horas a 37 minutos </h1> <p class="text-xl text-carbon/70 dark:text-alabaster/70 mb-4"> optimizaci√≥n de un proceso en data engineering </p> <div class="flex items-center gap-4 text-carbon/60 dark:text-alabaster/60"> <time datetime="2023-01-20T00:00:00.000Z"> 20 de enero de 2023 </time> </div> <div class="flex flex-wrap gap-2 mt-4"> <span class="px-3 py-1 bg-muted/30 dark:bg-seaweed/20 rounded-full text-sm text-carbon dark:text-alabaster"> BigData </span><span class="px-3 py-1 bg-muted/30 dark:bg-seaweed/20 rounded-full text-sm text-carbon dark:text-alabaster"> Aprendizaje </span><span class="px-3 py-1 bg-muted/30 dark:bg-seaweed/20 rounded-full text-sm text-carbon dark:text-alabaster"> LeanMind </span><span class="px-3 py-1 bg-muted/30 dark:bg-seaweed/20 rounded-full text-sm text-carbon dark:text-alabaster"> DataEngineering </span><span class="px-3 py-1 bg-muted/30 dark:bg-seaweed/20 rounded-full text-sm text-carbon dark:text-alabaster"> Blog </span> </div> </header> <div class="prose prose-lg dark:prose-invert max-w-none
                  prose-headings:text-stormy dark:prose-headings:text-seaweed
                  prose-a:text-stormy dark:prose-a:text-seaweed
                  prose-code:text-seaweed dark:prose-code:text-muted
                  prose-pre:bg-carbon dark:prose-pre:bg-stormy"> <h2 id="introducci√≥n">Introducci√≥n</h2>
<p>Este art√≠culo es muy similar al que Ulises escribi√≥ en su momento sobre <a href="https://ulisesantana.dev/blog/2022/como-pase-un-proceso-en-nodejs-de-5-horas-a-5-minutos/">como pas√≥ un proceso de 5 horas a 5 minutos</a> pero en un contexto diferente ya que no se trata de optimizar el c√≥digo en NodeJS sino que hablamos de Python aplicado a Ingenier√≠a de datos y en este caso ha sido <strong>pasar un proceso de 11 horas a 37 min</strong>. Pero mejor dejadme que os pongo en contexto:</p>
<h3 id="problemas-winter-is-coming">Problemas (Winter is coming)</h3>
<p>Actualmente disponemos de una herramienta llamada <a href="https://airflow.apache.org/">Apache Airflow</a> para gestionar la automatizaci√≥n de procesos. A estos, se les puede asignar mediante un crontab la frecuencia con la que se van a ejecutar y con ello dejar que hagan por su cuenta el trabajo especificado mediante c√≥digo en Python.</p>
<p>Uno de los muchos procesos que tenemos es el de extracci√≥n de datos de proveedores y su posterior tratamiento para que sean adaptados al dominio. Este proceso normalmente ten√≠a una <strong>duraci√≥n media de 5 horas</strong> lo cual era mas o menos pasable por varios motivos:</p>
<ul>
<li>Es un proceso autom√°tico que lo dejamos ejecutando normalmente de madrugada y a primera hora de la ma√±ana ya lo tenemos ejecutado</li>
<li>Maneja un volumen de datos elevado y todas las operaciones que ejecutamos llevan tiempo</li>
<li>No es necesario tenerlo al momento por lo que no es cr√≠tico para ning√∫n otro equipo</li>
</ul>
<p>Aqu√≠ dejo una captura para que comprueben que es algo que de vez en cuando tiene sus fallos pero que se solucionan con alguna revisi√≥n y suele ser algo estable:</p>
<p><img src="/assets/proceso11horas-1.png" alt="proceso11horas-1" title=" "></p>
<h3 id="y-lleg√≥-el-invierno">Y lleg√≥ el invierno</h3>
<p>Por un motivo u otro, se a√±adieron a la cola de procesado unos pocos millones m√°s de datos y eso termin√≥ por incrementar en exceso los tiempos de ejecuci√≥n. Concretamente se pas√≥ de 5 horas a 11:</p>
<p><img src="/assets/proceso11horas-2.png" alt="proceso11horas-2" title=" "></p>
<p>Esto ya se estaba yendo de nuestras manos y no era sostenible que un proceso durase casi medio d√≠a y que se lanza 2 veces en 24 horas‚Ä¶ Hagan sus cuentas.</p>
<h2 id="por-qu√©-ocurri√≥-esto">¬øPor qu√© ocurri√≥ esto?</h2>
<p>Es conocido que para tratamiento de Datos se usa una librer√≠a por excelencia que es <a href="https://pandas.pydata.org/">Pandas</a> y funciona muy bien la verdad. Sin embargo, para cantidades absurdas de datos tiene un p√©simo rendimiento y ah√≠ naci√≥ otra librer√≠a que usamos para optimizar grandes vol√∫menes que es <a href="https://www.dask.org/">Dask</a>.</p>
<p>En cantidades grandes de datos Dask le pega un repaso interesante a Pandas. Pero hay veces que Dask puede ser un poco dolor de cabeza si no se usa bien y existen muchos libros al respecto con buenas pr√°cticas. Entre ellos les recomiendo <a href="https://www.amazon.es/Data-Science-Scale-Python-Dask/dp/1617295604">Data Science at Scale with Python and Dask</a>.</p>
<p>Entonces supon√≠amos que algo mal est√°bamos haciendo con Dask y nos dispusimos a revisar el c√≥digo.</p>
<h2 id="misterios-misteriosos">Misterios misteriosos</h2>
<p>Primero revisamos qu√© hac√≠a nuestro proceso:</p>
<blockquote>
<p>Recoge 3 datasets, los junta en 1 y procesa los datos aplicando una lista de prioridad en base al origen de los datos. Lo que llamamos una <strong><code>provider_rank_list</code></strong> (tengan esto presente porque volveremos aqu√≠)</p>
</blockquote>
<p>Los 3 datasets de origen no vienen en 1 √∫nico fichero cada uno, sino que est√°n particionados ya que Dask los divide para que le sea m√°s f√°cil realizar las operaciones. Aqu√≠ nos dimos cuenta que las particiones eran min√∫sculas. Estamos hablando de <strong>1028 particiones de 1-2 Mb cada una</strong>‚Ä¶ Efectivamente esto mata a Dask y todo lo bueno y √≥ptimo que tiene termina por ser todo lo contrario.</p>
<p>Por lo que una de las mejoras que implementamos fue reducir esas 1028 particiones a ficheros m√°s grandes (pero manteniendo particiones para que Dask haga lo suyo).</p>
<p>As√≠ que aqu√≠ viene el super consejito del d√≠a:</p>
<blockquote>
<p>Si trabajas con Dask, aseg√∫rate de particionar acorde al volumen de datos. No tengas demasiadas particiones peque√±as ni pocas particiones muy grandes. Seg√∫n la documentaci√≥n oficial se recomiendan <strong>particiones de ~100Mb</strong></p>
</blockquote>
<p>No me gustar√≠a dejarles este ejemplo sin un pedacito de c√≥digo para asegurar que se entiende el proceso:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#E1E4E8">input_dataset </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> dask.read_dask(path_to_file)</span></span>
<span class="line"><span style="color:#E1E4E8">dataset_to_process </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> input_dataset.repartition(</span><span style="color:#FFAB70">partition_size</span><span style="color:#F97583">=</span><span style="color:#79B8FF">self</span><span style="color:#E1E4E8">._partition_size) </span><span style="color:#6A737D"># Arreglamos la entrada para asegurarnos que lo que nos viene no nos rompe nada</span></span>
<span class="line"><span style="color:#79B8FF">...</span></span>
<span class="line"><span style="color:#E1E4E8">Mucho c√≥digo que hace cosas</span><span style="color:#79B8FF">...</span></span>
<span class="line"><span style="color:#79B8FF">...</span></span>
<span class="line"><span style="color:#E1E4E8">result_dataframe </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> processed_dataset.repartition(</span><span style="color:#FFAB70">partition_size</span><span style="color:#F97583">=</span><span style="color:#79B8FF">self</span><span style="color:#E1E4E8">._partition_size) </span><span style="color:#6A737D"># Fijamos en la salida el mismo tama√±o por si durante el proceso ha crecido el volumen de datos</span></span></code></pre>
<h2 id="por-qu√©-fijarle-un-tama√±o-a-las-particiones-y-no-un-n√∫mero-fijo-de-ficheros-y-que-haga-dask-todo-el-trabajo">¬øPor qu√© fijarle un tama√±o a las particiones y no un n√∫mero fijo de ficheros y que haga Dask todo el trabajo?</h2>
<p>Me alegra que te hagas esa pregunta. Dask puede ser un poco dolor de cabeza. Existen 2 formas de particionar: <code>npartitions</code> y <code>partition_size</code>. npartitions fija un n√∫mero de particiones, ni m√°s ni menos de las que tu le indicas. Por otro lado partition_size fija el tama√±o m√°ximo de cada partici√≥n y adem√°s provoca que el Dask Dataframe se procese, lo cual a priori es negativo porque consume m√°s recursos y tarda m√°s. Pero no est√°bamos teniendo en cuenta que el procesado se iba a realizar s√≠ o s√≠, porque para guardarlo se transforma a Pandas (no lo hab√≠a dicho antes pero Dask est√° construido sobre Pandas).</p>
<blockquote>
<p>TLDR; La repartici√≥n estaba funcionando regular y nos le√≠mos mucha documentaci√≥n para utilizar la opci√≥n que mejor nos ven√≠a</p>
</blockquote>
<h2 id="y-color√≠n-colorado-este-cuento-a√∫n-no-se-ha-acabado">Y color√≠n colorado‚Ä¶ Este cuento a√∫n no se ha acabado :(</h2>
<p>¬øMejor√≥ el rendimiento? S√≠. ¬øTodo lo que nos gustar√≠a? No. El proceso a√∫n se tiraba unas cuantas horas buenas y segu√≠a siendo inviable. Hab√≠a que seguir buscando‚Ä¶</p>
<p>Hasta que dimos con una l√≠nea de c√≥digo</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#E1E4E8">dataframe.set_index(provider_priority_column)</span></span></code></pre>
<p>¬øQu√© hace el set_index? -> Ordena el dataframe en base al par√°metro que le indicas. En este caso como queremos filtrar datos en base a proveedores, pues queremos ordenarlos en base a unos numeritos. Por ejemplo:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#E1E4E8">{</span><span style="color:#79B8FF">"proveedor_chachi"</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">"proveedor_guay"</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">"proveedor_no_tan_chachi"</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">}</span></span></code></pre>
<p>Pues esto anteriormente, cuando se implement√≥ nos parec√≠a guay y una idea factible‚Ä¶ Pero al final no escalable ni mucho menos. A medida que aumentaba el volumen de datos, peor era el rendimiento de Dask para ordenar.</p>
<p>Seguro que si has llegado hasta aqu√≠, esperar√°s una soluci√≥n ultra compleja, casi como una receta m√°gica‚Ä¶ Lamento decirte que la soluci√≥n no tiene que ver con c√≥digo sino con planteamiento del problema.</p>
<h2 id="soluci√≥n">Soluci√≥n</h2>
<p>Como bien se hab√≠a dicho, el proceso coge 3 datasets y los junta en 1 para procesar los datos en base a una <strong>priority_rank_list</strong>. Pues se nos ocurri√≥ concatenar (es una operaci√≥n casi instant√°nea y que consume muy poco) en base a la lista de prioridad. As√≠ nos olvidamos de ordenar el resultado porque ya nos vendr√° ordenado y supondr√° mucha menos carga de trabajo. Tan sencillo como eso.</p>
<p>Esto en c√≥digo no tiene mucho sentido ponerlo pero los resultados hablan por s√≠ solos:</p>
<p><img src="/assets/proceso11horas-3.jpeg" alt="proceso11horas-3" title=" "></p>
<p>Y por si fuese de inter√©s, este planteamiento lo extendimos a los procesos que preceden. Les dejo una tabla con las mejoras de tiempo:</p>
<p><strong>Antes</strong></p>

































<table><thead><tr><th></th><th>Proceso 1</th><th>Proceso 2</th><th>Proceso 3</th><th>Tiempo total</th></tr></thead><tbody><tr><td>Proveedor A</td><td>~20 min</td><td>~8h50min</td><td>~11 horas</td><td>20h10min</td></tr><tr><td>Proveedor B</td><td>~20 min</td><td>~3h30min</td><td>~11 horas</td><td>14h50min</td></tr><tr><td>Proveedor C</td><td>~10 min</td><td>~7h</td><td>~11 horas</td><td>11h17min</td></tr></tbody></table>
<p><strong>Despu√©s</strong></p>

































<table><thead><tr><th></th><th>Proceso 1</th><th>Proceso 2</th><th>Proceso 3</th><th>Tiempo total</th></tr></thead><tbody><tr><td>Proveedor A</td><td>~20 min</td><td>~1h</td><td>~1-2h</td><td>3h20min</td></tr><tr><td>Proveedor B</td><td>~20 min</td><td>~45min</td><td>~1-2h</td><td>3h5min</td></tr><tr><td>Proveedor C</td><td>~10 min</td><td>~7min</td><td>~1-2h</td><td>2h17min</td></tr></tbody></table>
<p>Al final del d√≠a no solo hemos ahorrado tiempo de ejecuci√≥n, sino tambi√©n recursos de los Pods de Kubernetes que ejecutan esto y m√°quinas de AWS. Lo cual se traduce en menos dinero gastado</p>
<p>Y como bien se suele decir: Una imagen vale m√°s que mil palabras, por lo que les dejo una foto final de como la tormenta se calm√≥:
<img src="/assets/proceso11horas-4.png" alt="proceso11horas-4" title=" "></p> </div> </article> </main> <footer class="bg-carbon dark:bg-carbon-900 text-alabaster border-t border-carbon-700 dark:border-carbon-800"> <div class="container-custom py-12"> <!-- Main Footer Content --> <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-8"> <!-- Brand & Description --> <div class="space-y-4"> <h2 class="text-2xl font-bold text-seaweed">
Air√°n Sanchez
</h2> <p class="text-sm text-alabaster-400 max-w-xs"> footer.description </p> </div> <!-- Navigation Links --> <div class="space-y-4"> <h3 class="text-sm font-semibold uppercase tracking-wider text-muted"> footer.nav.main </h3> <nav aria-label="footer.nav.main"> <ul class="space-y-2"> <li> <a href="/es/" class="inline-flex items-center gap-1 duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-stormy focus-visible:ring-offset-2 rounded touch-manipulation dark:text-alabaster dark:hover:text-stormy-400 no-underline hover:underline underline-offset-4 text-sm text-alabaster-300 hover:text-seaweed transition-colors"> Inicio   </a> </li><li> <a href="/es/blog/" class="inline-flex items-center gap-1 duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-stormy focus-visible:ring-offset-2 rounded touch-manipulation dark:text-alabaster dark:hover:text-stormy-400 no-underline hover:underline underline-offset-4 text-sm text-alabaster-300 hover:text-seaweed transition-colors"> Blog   </a> </li> </ul> </nav> </div> <!-- Social Links --> <div class="space-y-4"> <h3 class="text-sm font-semibold uppercase tracking-wider text-muted"> S√≠gueme </h3> <nav aria-label="S√≠gueme"> <ul class="flex flex-wrap gap-3"> <li> <a href="https://github.com/yourusername" target="_blank" rel="noopener noreferrer" aria-label="footer.social.github" class="flex items-center justify-center w-10 h-10 rounded-lg bg-carbon-700 hover:bg-stormy dark:bg-carbon-800 dark:hover:bg-stormy text-alabaster hover:text-white transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-stormy ring-offset-2 ring-offset-carbon touch-manipulation group"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" class="lucide lucide-github w-5 h-5 group-hover:scale-110 transition-transform"> <path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2-7-2"></path>  </svg> </a> </li><li> <a href="https://linkedin.com/in/yourusername" target="_blank" rel="noopener noreferrer" aria-label="footer.social.linkedin" class="flex items-center justify-center w-10 h-10 rounded-lg bg-carbon-700 hover:bg-stormy dark:bg-carbon-800 dark:hover:bg-stormy text-alabaster hover:text-white transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-stormy ring-offset-2 ring-offset-carbon touch-manipulation group"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" class="lucide lucide-linkedin w-5 h-5 group-hover:scale-110 transition-transform"> <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect width="4" height="12" x="2" y="9"></rect><circle cx="4" cy="4" r="2"></circle>  </svg> </a> </li><li> <a href="https://twitter.com/yourusername" target="_blank" rel="noopener noreferrer" aria-label="footer.social.twitter" class="flex items-center justify-center w-10 h-10 rounded-lg bg-carbon-700 hover:bg-stormy dark:bg-carbon-800 dark:hover:bg-stormy text-alabaster hover:text-white transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-stormy ring-offset-2 ring-offset-carbon touch-manipulation group"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" class="lucide lucide-twitter w-5 h-5 group-hover:scale-110 transition-transform"> <path d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z"></path>  </svg> </a> </li><li> <a href="https://t.me/yourusername" target="_blank" rel="noopener noreferrer" aria-label="footer.social.telegram" class="flex items-center justify-center w-10 h-10 rounded-lg bg-carbon-700 hover:bg-stormy dark:bg-carbon-800 dark:hover:bg-stormy text-alabaster hover:text-white transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-stormy ring-offset-2 ring-offset-carbon touch-manipulation group"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" class="lucide lucide-send w-5 h-5 group-hover:scale-110 transition-transform"> <path d="M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z"></path><path d="m21.854 2.147-10.94 10.939"></path>  </svg> </a> </li><li> <a href="mailto:your.email@example.com" aria-label="footer.social.email" class="flex items-center justify-center w-10 h-10 rounded-lg bg-carbon-700 hover:bg-stormy dark:bg-carbon-800 dark:hover:bg-stormy text-alabaster hover:text-white transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-stormy ring-offset-2 ring-offset-carbon touch-manipulation group"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" class="lucide lucide-mail w-5 h-5 group-hover:scale-110 transition-transform"> <path d="m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7"></path><rect x="2" y="4" width="20" height="16" rx="2"></rect>  </svg> </a> </li> </ul> </nav> </div> </div> <!-- Bottom Bar --> <div class="pt-8 border-t border-carbon-700 dark:border-carbon-800"> <div class="flex flex-col md:flex-row justify-between items-center gap-4 text-sm text-alabaster-400"> <p>
¬© 2026 Air√°n Sanchez. footer.rights </p> <div class="flex items-center gap-4"> <p class="flex items-center gap-2"> <span>footer.madeWith</span> <span class="text-red-500" aria-label="love">‚ù§Ô∏è</span> <span>footer.using</span> <a href="https://astro.build" target="_blank" rel="noopener noreferrer" aria-label="https://astro.build (opens in new tab)" class="inline-flex items-center gap-1 duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-stormy focus-visible:ring-offset-2 rounded touch-manipulation dark:text-alabaster dark:hover:text-stormy-400 no-underline hover:underline underline-offset-4 text-seaweed hover:text-muted transition-colors font-medium"> 
Astro
 <svg class="w-4 h-4 inline-block" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path> </svg>  </a> </p> </div> </div> </div> </div> </footer>  </body></html>